<div class="post-card" *ngIf="post">
  <div class="post-header">
    <div class="user-section">
      <img
        *ngIf="post.user?.profileImage; else showGuestImage"
        [src]="post.user?.profileImage"
        class="pfp"
      />
      <ng-template #showGuestImage>
        <img src="guest.png" class="pfp" />
      </ng-template>
      <p>{{ post.user?.name }}</p>
    </div>
    <img src="more.png" class="more" />
  </div>

  <div class="post-main">
    <p>{{ post.description }}</p>
    <img
      *ngIf="post.imageUrl"
      [src]="post.imageUrl"
      class="post-image"
      alt="Post Image"
    />
    <video
      *ngIf="post.videoUrl"
      [src]="post.videoUrl"
      controls
      class="post-video"
    ></video>
  </div>

  <div class="post-footer">
    <span>👍 Likes {{ post.likes?.length || 0 }}</span>
    <span>💬 Comments {{ comments.length }}</span>
  </div>
</div>

<hr />

<div class="comment-form">
  <textarea
    [(ngModel)]="newComment"
    placeholder="Write a comment..."
    rows="2"
  ></textarea>
  <button (click)="addComment()" [disabled]="!newComment.trim()">Post</button>
</div>

<!-- Comments List -->
<div class="comment-list" *ngIf="comments.length > 0">
  <div class="comment" *ngFor="let comment of comments">
    <div class="comment-header">
      <strong>{{ comment.user?.name }}</strong>
      <span>{{ comment.createdAt | date: 'short' }}</span>

      <div class="menu-wrapper" tabindex="0">
  <button class="menu-button" aria-label="Open comment menu">⋮</button>
  <div class="menu-dropdown">
    <button (click)="startEdit(comment)">Edit</button>
    <button (click)="deleteComment(comment.id)">Delete</button>
  </div>
</div>

    <!-- Edit Mode -->
    <div *ngIf="editingCommentId === comment.id">
      <textarea [(ngModel)]="editedCommentText" rows="2"></textarea>
      <button (click)="updateComment(comment.id)">Save</button>
      <button (click)="cancelEdit()">Cancel</button>
    </div>

    <!-- Normal Mode -->
    <div *ngIf="editingCommentId !== comment.id">
      <div class="comment-body">{{ comment.text }}</div>
    </div>
  </div>
</div>